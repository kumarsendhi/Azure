!function(n){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],n):n(ko,ko.validation={})}(function(n,t){function s(n){var t="max"===n;return function(r,u){var o,h,s,f,e;if(i.utils.isEmptyVal(r))return!0;void 0===u.typeAttr?(h="text",o=u):(h=u.typeAttr,o=u.value);isNaN(o)||(h="number");switch(h.toLowerCase()){case"week":if(s=/^(\d{4})-W(\d{2})$/,f=r.match(s),null===f)throw"Invalid value for "+n+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min";return e=o.match(s),e?t?f[1]<e[1]||f[1]===e[1]&&f[2]<=e[2]:f[1]>e[1]||f[1]===e[1]&&f[2]>=e[2]:!1;case"month":if(s=/^(\d{4})-(\d{2})$/,f=r.match(s),null===f)throw"Invalid value for "+n+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min";return e=o.match(s),e?t?f[1]<e[1]||f[1]===e[1]&&f[2]<=e[2]:f[1]>e[1]||f[1]===e[1]&&f[2]>=e[2]:!1;case"number":case"range":return t?!isNaN(r)&&parseFloat(r)<=parseFloat(o):!isNaN(r)&&parseFloat(r)>=parseFloat(o);default:return t?o>=r:r>=o}}}function a(n,t,r){return t.validator(n(),void 0===r.params?!0:u(r.params))?!0:(n.setError(i.formatMessage(r.message||t.message,u(r.params),n)),!1)}function v(n,t,r){n.isValidating(!0);var f=function(f){var e=!1,o="";return n.__valid__()?(f.message?(e=f.isValid,o=f.message):e=f,e||(n.error(i.formatMessage(o||r.message||t.message,u(r.params),n)),n.__valid__(e)),n.isValidating(!1),void 0):(n.isValidating(!1),void 0)};t.validator(n(),u(r.params||!0),f)}var c,l;if(void 0===typeof n)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";n.validation=t;var i=n.validation,e=n.utils,u=e.unwrapObservable,f=e.arrayForEach,r=e.extend,h={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateInputElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:!1,grouping:{deep:!1,observable:!0,live:!1},validate:{}},o=r({},h);o.html5Attributes=["required","pattern","min","max","step"];o.html5InputTypes=["email","number","date"];o.reset=function(){r(o,h)};i.configuration=o;i.utils=function(){var r=(new Date).getTime(),t={},n="__ko_validation__";return{isArray:function(n){return n.isArray||"[object Array]"===Object.prototype.toString.call(n)},isObject:function(n){return null!==n&&"object"==typeof n},isObservableArray:function(n){return!!n&&"function"==typeof n.remove&&"function"==typeof n.removeAll&&"function"==typeof n.destroy&&"function"==typeof n.destroyAll&&"function"==typeof n.indexOf&&"function"==typeof n.replace},values:function(n){var i=[],t;for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);return i},getValue:function(n){return"function"==typeof n?n():n},hasAttribute:function(n,t){return null!==n.getAttribute(t)},getAttribute:function(n,t){return n.getAttribute(t)},setAttribute:function(n,t,i){return n.setAttribute(t,i)},isValidatable:function(n){return!!(n&&n.rules&&n.isValid&&n.isModified)},insertAfter:function(n,t){n.parentNode.insertBefore(t,n.nextSibling)},newId:function(){return r+=1},getConfigOptions:function(n){var t=i.utils.contextFor(n);return t||i.configuration},setDomData:function(r,u){var f=r[n];f||(r[n]=f=i.utils.newId());t[f]=u},getDomData:function(i){var r=i[n];if(r)return t[r]},contextFor:function(n){switch(n.nodeType){case 1:case 8:var t=i.utils.getDomData(n);if(t)return t;if(n.parentNode)return i.utils.contextFor(n.parentNode)}return void 0},isEmptyVal:function(n){return void 0===n?!0:null===n?!0:""===n?!0:void 0},getOriginalElementTitle:function(n){var t=i.utils.getAttribute(n,"data-orig-title"),r=n.title,u=i.utils.hasAttribute(n,"data-orig-title");return u?t:r},async:function(n){window.setImmediate?window.setImmediate(n):window.setTimeout(n,0)},forEach:function(n,t){if(i.utils.isArray(n))return f(n,t);for(var r in n)n.hasOwnProperty(r)&&t(n[r],r)}}}();c=function(){function h(n){f(n.subscriptions,function(n){n.dispose()});n.subscriptions=[]}function v(n){n.options.deep&&(f(n.flagged,function(n){delete n.__kv_traversed}),n.flagged.length=0);n.options.live||h(n)}function s(n,t){t.validatables=[];h(t);c(n,t);v(t)}function c(i,r,u){var e=[],f=i.peek?i.peek():i;i.__kv_traversed!==!0&&(r.options.deep&&(i.__kv_traversed=!0,r.flagged.push(i)),u=void 0!==u?u:r.options.deep?1:-1,n.isObservable(i)&&(i.isValid||i.extend({validatable:!0}),r.validatables.push(i),r.options.live&&t.isObservableArray(i)&&r.subscriptions.push(i.subscribe(function(){r.graphMonitor.valueHasMutated()}))),f&&!f._destroy&&(t.isArray(f)?e=f:t.isObject(f)&&(e=t.values(f))),0!==u&&t.forEach(e,function(n){n&&!n.nodeType&&c(n,r,u+1)}))}function l(n){var t=[];return f(n,function(n){n.isValid()||t.push(n.error())}),t}var a=0,o=i.configuration,t=i.utils;return{init:function(n,t){a>0&&!t||(n=n||{},n.errorElementClass=n.errorElementClass||n.errorClass||o.errorElementClass,n.errorMessageClass=n.errorMessageClass||n.errorClass||o.errorMessageClass,r(o,n),o.registerExtenders&&i.registerExtenders(),a=1)},configure:function(n){i.init(n)},reset:i.configuration.reset,group:function(t,i){i=r(r({},o.grouping),i);var u={options:i,graphMonitor:n.observable(),flagged:[],subscriptions:[],validatables:[]},h=null;return i.observable?(s(t,u),h=n.computed(function(){return u.graphMonitor(),s(t,u),l(u.validatables)})):h=function(){return s(t,u),l(u.validatables)},h.showAllMessages=function(n){void 0===n&&(n=!0);h();f(u.validatables,function(t){t.isModified(n)})},t.errors=h,t.isValid=function(){return 0===t.errors().length},t.isAnyMessageShown=function(){var n=!1;return h(),n=!!e.arrayFirst(u.validatables,function(n){return!n.isValid()&&n.isModified()})},h},formatMessage:function(n,t,i){return"function"==typeof n?n(t,i):n.replace(/\{0\}/gi,u(t))},addRule:function(n,t){return n.extend({validatable:!0}),n.rules.push(t),n},addAnonymousRule:function(n,t){void 0===t.message&&(t.message="Error");t.onlyIf&&(t.condition=t.onlyIf);i.addRule(n,t)},addExtender:function(r){n.extenders[r]=function(n,u){return u&&(u.message||u.onlyIf)?i.addRule(n,{rule:r,message:u.message,params:t.isEmptyVal(u.params)?!0:u.params,condition:u.onlyIf}):i.addRule(n,{rule:r,params:u})}},registerExtenders:function(){if(o.registerExtenders)for(var t in i.rules)i.rules.hasOwnProperty(t)&&(n.extenders[t]||i.addExtender(t))},insertValidationMessage:function(n){var i=document.createElement("SPAN");return i.className=t.getConfigOptions(n).errorMessageClass,t.insertAfter(n,i),i},parseInputValidationAttributes:function(n,r){f(i.configuration.html5Attributes,function(u){var e,f;t.hasAttribute(n,u)&&(e=n.getAttribute(u)||!0,("min"===u||"max"===u)&&(f=n.getAttribute("type"),"undefined"!=typeof f&&f||(f="text"),e={typeAttr:f,value:e}),i.addRule(r(),{rule:u,params:e}))});var u=n.getAttribute("type");f(i.configuration.html5InputTypes,function(n){n===u&&i.addRule(r(),{rule:"date"===n?"dateISO":n,params:!0})})},writeInputValidationAttributes:function(n,t){var r=t(),u;r&&r.rules&&(u=r.rules(),f(i.configuration.html5Attributes,function(t){var r,i=e.arrayFirst(u,function(n){return n.rule.toLowerCase()===t.toLowerCase()});i&&(r=i.params,"pattern"===i.rule&&i.params instanceof RegExp&&(r=i.params.source),n.setAttribute(t,r))}),u=null)},makeBindingHandlerValidatable:function(t){var i=n.bindingHandlers[t].init;n.bindingHandlers[t].init=function(t,r,u,f,e){return i(t,r,u,f,e),n.bindingHandlers.validationCore.init(t,r,u,f,e)}},setRules:function(r,f){var e=function(r,f){var s,h,o,l;if(r&&f)for(s in f)if(f.hasOwnProperty(s)&&(h=f[s],r[s])){var a=r[s],c=u(a),y={},v={};for(o in h)h.hasOwnProperty(o)&&(i.rules[o]?y[o]=h[o]:v[o]=h[o]);if(n.isObservable(a)&&a.extend(y),c&&t.isArray(c))for(l=0;l<c.length;l++)e(c[l],v);else e(c,v)}};e(r,f)}}}();r(n.validation,c);i.rules={};i.rules.required={validator:function(n,t){var i;return void 0===n||null===n?!t:(i=n,"string"==typeof n&&(i=n.replace(/^\s+|\s+$/g,"")),t?(i+"").length>0:!0)},message:"This field is required."};i.rules.min={validator:s("min"),message:"Please enter a value greater than or equal to {0}."};i.rules.max={validator:s("max"),message:"Please enter a value less than or equal to {0}."};i.rules.minLength={validator:function(n,t){return i.utils.isEmptyVal(n)||n.length>=t},message:"Please enter at least {0} characters."};i.rules.maxLength={validator:function(n,t){return i.utils.isEmptyVal(n)||n.length<=t},message:"Please enter no more than {0} characters."};i.rules.pattern={validator:function(n,t){return i.utils.isEmptyVal(n)||null!==n.toString().match(t)},message:"Please check this value."};i.rules.step={validator:function(n,t){if(i.utils.isEmptyVal(n)||"any"===t)return!0;var r=100*n%(100*t);return Math.abs(r)<1e-5||Math.abs(1-r)<1e-5},message:"The value must increment by {0}"};i.rules.email={validator:function(n,t){return t?i.utils.isEmptyVal(n)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(n):!0},message:"Please enter a proper email address"};i.rules.date={validator:function(n,t){return t?i.utils.isEmptyVal(n)||t&&!/Invalid|NaN/.test(new Date(n)):!0},message:"Please enter a proper date"};i.rules.dateISO={validator:function(n,t){return t?i.utils.isEmptyVal(n)||t&&/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(n):!0},message:"Please enter a proper date"};i.rules.number={validator:function(n,t){return t?i.utils.isEmptyVal(n)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(n):!0},message:"Please enter a number"};i.rules.digit={validator:function(n,t){return t?i.utils.isEmptyVal(n)||t&&/^\d+$/.test(n):!0},message:"Please enter a digit"};i.rules.phoneUS={validator:function(n,t){return t?i.utils.isEmptyVal(n)?!0:"string"!=typeof n?!1:(n=n.replace(/\s+/g,""),t&&n.length>9&&n.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Please specify a valid phone number"};i.rules.equal={validator:function(n,t){var r=t;return n===i.utils.getValue(r)},message:"Values must equal"};i.rules.notEqual={validator:function(n,t){var r=t;return n!==i.utils.getValue(r)},message:"Please choose another value."};i.rules.unique={validator:function(n,t){var r=i.utils.getValue(t.collection),f=i.utils.getValue(t.externalValue),u=0;return n&&r?(e.arrayFilter(r,function(i){n===(t.valueAccessor?t.valueAccessor(i):i)&&u++}),(f?1:2)>u):!0},message:"Please make sure the value is unique."},function(){i.registerExtenders()}();n.bindingHandlers.validationCore=function(){return{init:function(t,r){var u=i.utils.getConfigOptions(t),f=r(),e;(u.parseInputAttributes&&i.utils.async(function(){i.parseInputValidationAttributes(t,r)}),u.insertMessages&&i.utils.isValidatable(f))&&(e=i.insertValidationMessage(t),u.messageTemplate?n.renderTemplate(u.messageTemplate,{field:f},null,e,"replaceNode"):n.applyBindingsToNode(e,{validationMessage:f}));u.writeInputAttributes&&i.utils.isValidatable(f)&&i.writeInputValidationAttributes(t,r);u.decorateInputElement&&i.utils.isValidatable(f)&&n.applyBindingsToNode(t,{validationElement:f})}}}();i.makeBindingHandlerValidatable("value");i.makeBindingHandlerValidatable("checked");n.bindingHandlers.validationMessage={update:function(t,r){var f=r(),s=i.utils.getConfigOptions(t),h=(u(f),!1),c=!1,o,l,a;if(!f.isValid||!f.isModified)throw new Error("Observable is not validatable");h=f.isModified();c=f.isValid();o=null;(!s.messagesOnModified||h)&&(o=c?null:f.error);l=!s.messagesOnModified||h?!c:!1;a="none"!==t.style.display;s.allowHtmlMessages?e.setHtml(t,o):n.bindingHandlers.text.update(t,function(){return o});a&&!l?t.style.display="none":!a&&l&&(t.style.display="")}};n.bindingHandlers.validationElement={update:function(t,r,f){var e=r(),o=i.utils.getConfigOptions(t),h=(u(e),!1),s=!1,c;if(!e.isValid||!e.isModified)throw new Error("Observable is not validatable");h=e.isModified();s=e.isValid();c=function(){var n={},t=!o.decorateElementOnModified||h?!s:!1;return n[o.errorElementClass]=t,n};n.bindingHandlers.css.update(t,c,f);o.errorsAsTitle&&n.bindingHandlers.attr.update(t,function(){var n=!o.errorsAsTitleOnModified||h,r=i.utils.getOriginalElementTitle(t);return n&&!s?{title:e.error,"data-orig-title":r}:!n||s?{title:r,"data-orig-title":null}:void 0})}};n.bindingHandlers.validationOptions=function(){return{init:function(n,t){var e=u(t()),f;e&&(f=r({},i.configuration),r(f,e),i.utils.setDomData(n,f))}}}();n.extenders.validation=function(n,t){return f(i.utils.isArray(t)?t:[t],function(t){i.addAnonymousRule(n,t)}),n};n.extenders.validatable=function(t,u){var o,f,s,e;return(i.utils.isObject(u)||(u={enable:u}),"enable"in u||(u.enable=!0),u.enable&&!i.utils.isValidatable(t))?(o=i.configuration.validate||{},f={throttleEvaluation:u.throttle||o.throttle},t.error=n.observable(null),t.rules=n.observableArray(),t.isValidating=n.observable(!1),t.__valid__=n.observable(!0),t.isModified=n.observable(!1),t.isValid=n.computed(t.__valid__),t.setError=function(n){t.error(n);t.__valid__(!1)},t.clearError=function(){return t.error(null),t.__valid__(!0),t},s=t.subscribe(function(){t.isModified(!0)}),e=n.computed(r({read:function(){return t(),t.rules(),i.validateObservable(t),!0}},f)),r(e,f),t._disposeValidation=function(){t.isValid.dispose();t.rules.removeAll();t.isModified.getSubscriptionsCount()>0&&(t.isModified._subscriptions.change=[]);t.isValidating.getSubscriptionsCount()>0&&(t.isValidating._subscriptions.change=[]);t.__valid__.getSubscriptionsCount()>0&&(t.__valid__._subscriptions.change=[]);s.dispose();e.dispose();delete t.rules;delete t.error;delete t.isValid;delete t.isValidating;delete t.__valid__;delete t.isModified}):u.enable===!1&&t._disposeValidation&&t._disposeValidation(),t};i.validateObservable=function(n){for(var r,t,u=0,f=n.rules(),e=f.length;e>u;u++)if(t=f[u],!t.condition||t.condition())if(r=t.rule?i.rules[t.rule]:t,r.async||t.async)v(n,r,t);else if(!a(n,r,t))return!1;return n.clearError(),!0};i.localize=function(n){var t;for(t in n)i.rules.hasOwnProperty(t)&&(i.rules[t].message=n[t])};n.applyBindingsWithValidation=function(t,r,u){var f,e,o=arguments.length;o>2?(f=r,e=u):2>o?f=document.body:arguments[1].nodeType?f=r:e=arguments[1];i.init();e&&i.utils.setDomData(f,e);n.applyBindings(t,r)};l=n.applyBindings;n.applyBindings=function(n,t){i.init();l(n,t)};n.validatedObservable=function(t){if(!i.utils.isObject(t))return n.observable(t).extend({validatable:!0});var r=n.observable(t);return r.errors=i.group(t),r.isValid=n.observable(t.isValid()),r.errors.subscribe(function(n){r.isValid(0===n.length)}),r}})