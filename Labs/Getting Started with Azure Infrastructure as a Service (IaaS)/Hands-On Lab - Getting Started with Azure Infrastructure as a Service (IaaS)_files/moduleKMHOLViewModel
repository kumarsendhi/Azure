var moduleKMViewModel={moduleTitle:ko.observable(),totalQuestionCount:ko.observable(),currentQuestionCount:ko.observable(),selectedQuestion:ko.observable(),answerChoices:ko.observableArray([]),enableNext:ko.observable(),selectedQuestionId:null,selectedAnswerId:null,userAnswers:ko.observableArray([]),index:0,moduleQuestions:null,courseId:null,CourseModuleId:null,IsLab:ko.observable(!0),KmResult:ko.observableArray([]),kmScore:ko.observable(),IsMultipleChoice:ko.observable(!0),detailedAnswer:ko.observable(),loadModuleKMInfo:function(n){ajaxRequest.makeAPIRequest("/Module/GetModuleKnowledgeMeasure","GET",{courseModuleId:n},function(n){moduleKMViewModel.CourseModuleId=n.CourseModuleId;moduleKMViewModel.courseId=n.CourseId;moduleKMViewModel.moduleTitle(n.Module.TrainingMaterial.Title);moduleKMViewModel.totalQuestionCount(n.Module.KnowledgeMeasureCount);moduleKMViewModel.moduleQuestions=n.Module.ModuleKMs;moduleKMViewModel.enableNext(!1);n.Module.KnowledgeMeasureCount>0&&(moduleKMViewModel.IsLab(!0),moduleKMViewModel.index=0,moduleKMViewModel.setupQuestion());moduleKMViewModel.userAnswers.removeAll();$("#kmDialog").modal("show")})},nextQuestion:function(){moduleKMViewModel.userAnswers.push({ModuleKMId:moduleKMViewModel.selectedQuestionId,SelectedAnswerId:moduleKMViewModel.selectedAnswerId,CourseModuleId:moduleKMViewModel.CourseModuleId,DetailedAnswer:moduleKMViewModel.detailedAnswer()});moduleKMViewModel.index++;moduleKMViewModel.setupQuestion();moduleKMViewModel.enableNext(!1)},setupQuestion:function(){var n=moduleKMViewModel.moduleQuestions[moduleKMViewModel.index],t;moduleKMViewModel.selectedQuestion(n.KMQuestion.Description);moduleKMViewModel.selectedQuestionId=n.ModuleKMId;moduleKMViewModel.answerChoices(n.KMQuestion.KMAnswers);moduleKMViewModel.currentQuestionCount(moduleKMViewModel.index+1);t=moduleKMViewModel.moduleQuestions[moduleKMViewModel.index].KMQuestion;t.KMQuestionTypeId==1?moduleKMViewModel.IsMultipleChoice(!0):moduleKMViewModel.IsMultipleChoice(!1)},onAnswerSelection:function(n){return n!=null?(moduleKMViewModel.enableNext(!0),!0):moduleKMViewModel.detailedAnswer().length>0?(moduleKMViewModel.enableNext(!0),moduleKMViewModel.selectedAnswerId=null,!0):(moduleKMViewModel.enableNext(!1),!1)},back:function(){ajaxRequest.makeAPIRequest("/Course/GetTrainingMaterialCode","GET",{id:moduleKMViewModel.courseId},function(n){if($("#kmDialog").modal("hide"),moduleKMViewModel.kmScore()!=""){var t=parseFloat(moduleKMViewModel.kmScore());t<60&&opsgility.showNotificationMessage("Message ","Your KM score is : "+moduleKMViewModel.kmScore()+"% .<br>You need to reappear for KM after 24 hrs.",!1)}moduleViewModel.moduleActivityOnUnload();moduleViewModel.loadCourseModulesData(n,moduleKMViewModel.CourseModuleId)})},submitKM:function(){moduleKMViewModel.userAnswers.push({ModuleKMId:moduleKMViewModel.selectedQuestionId,SelectedAnswerId:moduleKMViewModel.selectedAnswerId,CourseModuleId:moduleKMViewModel.CourseModuleId,DetailedAnswer:moduleKMViewModel.detailedAnswer()});var n=ko.toJSON(moduleKMViewModel.userAnswers);ajaxRequest.makeAPIRequest("/Module/SaveKM","POST",n,function(n){n&&(moduleKMViewModel.IsLab(!1),moduleKMViewModel.KmResult(n.ModuleKMs),moduleKMViewModel.kmScore(n.KMScore))})}}